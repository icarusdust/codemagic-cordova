workflows:
  android-workflow:
    name: Android Cordova workflow
    environment:
      vars:
        KEYSTORE: Encrypted(Z0FBQUFBQmcwYzZSeC1EN1doaS1Rekp5d2xYaE1IdWUwQzJmcndoTmFlNndFQndnM3JKdG5zcHVMY1A0QXNnMHVPM1JTZkJlX0h4UHJ6OFZYbjhDclg1ZDBTT0ZYM2JTQXVJWlc5TDQya2NyMG5EcURRS0hWTXA2ZGc4VzJfeTlxaC1DaTlqejlvOEtocjQyYWZfNzY4ekRVMWtLalg5RHFYdC0tWUhKSjhOTG1lM0l4aFZFUWtzcndtT2NlcTZMZHN4UUtGVEczM1lYY0pWZGh1RE93NUZ4SVJucGRtNDlOeTBNT3RIRklvZGZfZ2lReHJmQVRzQnhNUTZoRlVwSVFDV2pqZDNMTUd0U2psRDdXLWJoUTE1OEM3NDN4TmotYnRqel91elg2RG5YMlBaMXZFOWotTlZmcFV1SlowVkZZdVkxWjFYQTFZd2ZkekZMekdZWFBrZUU1QW5PbF9OWEhHNVlYeExvaExFaEx2Y2p5VXJMTDRmT2MzSEpHZ1FKeFRZQ0otdUcwOGFkZFo1eFdpZU1oMjlGSWhEa1JLM0VuNXpCUFhQU3Z3UTFLczhaVngtclVOVVE4QXNCV1dnbXRPVE1lMGJTWlJ0a011cUxpSkZhLVN1bFdSNk5kTGVMVlhZR1BSeEdYUXlYZ2x5eVdUZVROdGNDZmxzVTRFVHVOUGM3ejVnVl90THBQLTlzZFQzQ2xwSkNqTkNGU1lRUlhoRXBYTmgtSTBqVUdqNkpodC1rYlBxWkZEdVFuQUVKMGpqempGOWFFQTVlS09EY29kbWpVbzRHNGNVaENIZzFBdkVFcTJkSm5JRXRkUE1xRjBxbXczWmlmeG5UZk1lN1RQMzBQR0VfRGtBOU1QaE9OVC13UUZaN001V1lOelFVal80VS1ZUTV6aFFSbjBhLXJ3ZHp2Q2t2XzlQd0pYbVUyZjJCUlllaTdwUFZBVTJsREpBdTVmcGM0VlZQM1ZGTDZHTHhlVFljNGFydWlOWExBNUxPdC1nMUlhY0RHNEJ3Wkl0WU90ZUlKd2xvVEVaX185d2Y3SUlGN1I3QXowYmZ5c2VJejduRm0temVvQkxyNngwN2NnaDhRUEVFclc4Z055TmkzZUszcVB2TlAzbTdkT0JVM1BmS05wR1pjTDVLb2xoQVRxbWZWMnNmNjhNRjhHc2ZueXhLWkVYSk1sOTB0SlVuaVRic2JoWGlmVVJNTUdvZ3BqRnRUbjEybVlRSFFNeTN0UDROQkJ3Mm9BeWdleU8wa2J0anFsMjNZR3l3S1JKOHpYSlN4Tkt1WlA0OGpiMlQ5SU42SWFWeEduWXhNejJqTEJuTFl0WjRRVS1CUlZzT2diVDhuOUdQaW13Z2FuWUluMFhqMUFzMGhKWVN5OWFGNzNYRF80LWxoNmJoekJQSTFpalowQ1JSZjhBTnl1c01MZjJCenJwZjhIaDZjeWlGaTQyejRuaVVxMDBTM1dnTkRaaUgta0U5RUlVQURJek1yTGNHaUNLTEZPaGhjTloxRFhUcTh0T3F1TGkxb2kzOERkbEZ6di15NzN5YmhlT21vZlFXYVdMMTZ0VENtNW5hUGZKOEFDY010XzhxWVZkY0hsaXkyenlmMS1OSnBkdmx3WGc3dW52UlJVSWVHVjF3dkZaMUJWNTByOTFfV0dZWC1zQUVReE10WnJrTEw4YmlwWEcyVWw5eVNuV2tGVkJWN3VxMEtkcGRJT0ZQVDJUMTZRY2cyTzY3ay1yWDIyQk85Ym1KNXYyMTdXX1UyZ25xN2ZiblU0MVRGemMxZEdET0ltWlI5eUVadGQxR2hJMzlZc3JuanY4NGhKejhEeFc4MTBSaFRFY183YXVZc1hYaW10eTRialdiNFJyUUN6OTZLdVF0YnlJTDJlbnpPNUdVZUxrRkJhbXJpLVp0VW04SFFLTmpSNkhlMkdRRklPTndqaW5Tb3h2RHhsWTMzeUd2bF9LcHFjaHlSMFp1TUYzQmthVE9vQ0NJWG12VzhjbGNqdFNqWTZfdlhOOVRjdEtWQ2oxdkhqcHpPTnI5T2xTVmhTMmR2NWtTbW1SNFFqQzVacThwNkxPN2Z3TWRyTVN0V2pnWnBKdG9UNUxmc0ZIY3ZGQ29hNFJsbEZhTzRQQldfbkNaTVJLUlJjdlNLTnBxcFRDV28wZGV4aDRWVDMySmtLNjREblo4d1N3UDR4cDVYQzUxVUY4REVyazdGd0dETGZpYlNfeDM4ZWI0Q0poRE02cVFoZC0tRFNWakdYeU0teGJmWFYxQWNEWHAzV1hpSXVQMTVyeERySHJFcHBRS29hZi00aHFmWTJGSkNtazhfRU1ZLTZfdzBGT0thSmNpenlMY01tOTRuaVB2NmxVUzYtNHdjRUVnZlZjS3BMTGJJbVJYU3hlVTBwZndyb3BtdGVuamNyaG9yTkpzY0k1dzNGTFcxWDNUQ2VYMVBYZktqX01HWHBCT2Zrb0kzSE1xUGNHUWc4SkU3R01QeS1MQ09YT1l0UFhBMnY3OUdmNjJlMlkyOVh5QmQ3Tk9JTzhFR3l6R1J1VHZQa2FxUTdzRGk0S1dzb3NPLXJGVUdvLUdvYm13SFo0b1lIQlJBcVJIZGZsOEpfUXNQR21Ga3lmWVFzYVJWelBuMm82S0hzMTJQY0RqSjdkM3RCMTBkTEg4c2puaVhLMklQRV9BN2Z0ZVdqUFprUHpzN25HUWstRVZObXZpdEZvQ2hKWWQtQmdqVkxfdkd1VzdBanZDbVpxU2ZSSWs0M2RuUjJqa3BaM2RTUGZ0dmM0Q1gyMkt0UmtRWEtTNWd0Z0QwemxhNVVSY0NUdmVUZkVxX2o2cTRBWEJyZXh3QVBLLUxWSzlQV2FFSktXYjFqMTVQRjBhSHY0d1VydXMzbnhHQXl4RFlxMDJ0RVNPYlhzUElnai1MSU1HMW80S0ZSSllmOG5VUjNPY3d5WUtfeV9GbW9oT2taa0JOX3JyMWtTUTgtcXFoUVR2STl1aWZRTF9MT2RSNUROUjRuektGWWN0aDFxVGtmV2hKWHM0dWJJd1hyRFI0Z3JZaGxhVlNiRFU5d2JGUkQ3WDFCX3dpWFRqYms0S0xDVFlfYkp5SVRnR3laaV80MFcxdkk5S3o0YzRXMmlLWDc2ZGF0UnBrb3pNYUV1UEMydjRqbWg4cXZJM01PcHlmR24yZ1BkcVpRN0MyQXd5NkFuc3N2YUVnQTdFZlJXbGo2cTZ3b2NQY0QxczlOcmhBX01YQm5Ec0JjMWMzTkN2YXpPS0t6aFRPMHEtZWloclhPSEQ1YzBXbzR5TjZkMlphWW1LZS0zUDBBc3RGa0VwOV9HRFR3aE1iYkVHdEJydjVBWTI5bWRqbmxsNlZxczJOQU45aEMwV2JsSUxVWnFrMGgzMHRhOTV6ZkZjeXFJZlM1Ni1Lc0lKdmpTampMODEtV3pQU2kzblQzdlE0d3lDNjA3R2hBekJzOUNnMUg2TmhDX0NIb3F0OEZKRnlSS1BhVUQxTS1zQ0YxX3pxMXh2MWktdFZVTjdwU0JHQkJKbHYxVWlYSmlad0N2ZF84UXh0aU53MlVjU1lVYXpXaTNjZVA3bWhCclRVUlhQSGZ4Yk91WjBjeU1EV2lzQzQyVG96VGxaRnpkcHIxWVhwNzZTbEZUWDBTcXpROFJJVUtOT3JJYVpnNU5oRzFCNDZfaEJHQXE0ZTlCSDdSYlh4c1kwWW0wY0stRzZlU1AyZzhNNzJHeHZnaWhDZjVyNjA4RlRSaTVIQmR1eDJKUmNsbFBvUWoyX0VHajMwLVZERzNWNThZdU5PaDMzQXZtZExqc1VCeFZmTVJBUzRzZEx5Z09qY21EemhEZ2pnOUFOSURFUjA5R2xLeTZUckVONTZYTm1LZE4tVDh1X202QmpYNVgtc185cnVCV090RVNXRXhYRkl4UTNXYUVwZGVNbXNCdHA5aDBybW44T1JOQWozcWNJamdnVVhHcm1lNFF4Ri1lcURmblQ2UEtiTkgtN29WWUZMZWs2NmtXVmVyVnVfdXdzTDVwcVlDLVctV3FMQXhjMm5KbHlXTFRNeHJyblNHdURVclZ5MXJwbmdGN0ZQUTZHT2hlNUFWdnBUdHZhWHo3X0plZzRFQ1l0dWt4Y1NsVGkxVHNsb1hIdXJIcGRyWHRPaHl3QzJnQ1NoZ09hekFOUjcwdHdVWUVKRFp4bVNWc1lzVk80UXd5bjVlWWhDRXVjdi15cm1GcVhDNHNKN0o3bjZXSW43VXdlWmpyN0ZLT3Foa2tvQzNHbnRTQmV1ZUw1WXhVaWVCaExIS3pCQloxVk90X241dUpncmFvb1c3aktBWTFWZEpVUUxBYURPcXRhVktWaUJQUXRQV3p1RVloYldzTDZvakNmVHdxeVBwU1ZyR2ZvNF9lRlUxS0JQQkdOQ1Z2eFZNV1YzZ0dIdkxRZ2hpRVJkUDdhOE1CLTZUNXZzektRSmg5SklRNXNnSDdVQVJWMXE2MDBPc1FhU3R6Sm5yTmREbS1zQXBxaVBHRHp3b01IWUdwdE05aDN3U3VXaE5temJudllmalkyd0RGNHA1TEU5UXpOZGNUY2w4Y01udi1GT25MaklhbWtOdmN5SGZQUC1rZ2EyampLOUZrcXRYZGZPTFM4QTZWQWhmWk5CV3g0Wi1aTHBuT0xuMmF4RTdGOW42SzlKbUhwZ0RTZmJ6QlpRamJhazVrNFU5eXRnRXB6NnNZVl9vcVpnSHRBbzN0NkJKMmVNX3FkeDU0aVV0cUJ0SG5MMzdVb1lSOHhyWnRlUnBBNUd6bDZNSldUVmxXeFUxNE9GSnJpR3o1ejJhNFMybC02RTlKbTI2Z3VkQWdzaUZNS3hXSjNQbmJtNDVOa2F5UjBrWVQ0bFJkclhzMmpObDFLWS1yekdVUmRwY1VSSjRMRlkyaXkybjRwRHFQY3lILXlOa2JneklMRlVhOWVOVDBvZXNwNlhFNjhrRWU0UzhBNXczNmxBT0t5VDFxd0FnV3NjLTFiNkFBNnViOFliNTVCTW5sUHI3b0lsTnR2Y0tlVktrbktGMXZwV1drUTdaTGFhenMyMTlHSWhmUnpiVTN0YzZmTGdMM3c5dUk1eGhIWjlndXBCeW0wT3NaaXB1YlZoUVVwQjhlLUVPVFJQdEZsaWxweGZVY2hhbUlZNkdDcXVkMkhSMWVfZk1lNUMySGJDeEtpQzFwM2hXMjlINUFMOExZa3lfbjNhNWU1WjhwZDl5NDJKRUxqMV92T0ExenZnVTllaktZNVdqaURfOWl6RVRMeFY3Qy1CMl9XaHIzTEJHZzRMWGhPQTRpam5NTnlBYXRxSm14UFR1eTNkX196SDNsTDdFMF9XcGtCaTVlZW1rVEg4WnQ0bzBqQ3pnbHdSNS12SUR6WnJHUTRkcXd2dDZwMmYzRE9qUnR3NUVzMGRMUUhELThjMlYwcGZrcz0=) # <-- Put your encrypted keystore file here
        KEYSTORE_PATH: '/tmp/keystore.keystore'
        KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmcwYzZ2aDJjZHR1bkJ3MUtDSFpvdmtCNmVyLUJrbV9OQjl1aUZkaHN3VFZQYldISXBhVXo3NzlDLWJQaXdSYUNsTGFJRlZvaEJ5SW5mVjBjWHJRTEo0Y0hTbGc9PQ==) # <-- Put your encrypted keystore password here
        KEY_ALIAS_PASSWORD: Encrypted(Z0FBQUFBQmcwYzZ2aDJjZHR1bkJ3MUtDSFpvdmtCNmVyLUJrbV9OQjl1aUZkaHN3VFZQYldISXBhVXo3NzlDLWJQaXdSYUNsTGFJRlZvaEJ5SW5mVjBjWHJRTEo0Y0hTbGc9PQ==) # <-- Put your encrypted keystore alias password here
        KEY_ALIAS: Encrypted(Z0FBQUFBQmcwYzZ2aDJjZHR1bkJ3MUtDSFpvdmtCNmVyLUJrbV9OQjl1aUZkaHN3VFZQYldISXBhVXo3NzlDLWJQaXdSYUNsTGFJRlZvaEJ5SW5mVjBjWHJRTEo0Y0hTbGc9PQ==) # <-- Put your encrypted alias password here
      xcode: 12.4
      node: 12
      npm: 6
    cache:
      cache_paths:
        - $FCI_BUILD_DIR/node_modules
    scripts:
      - name: Install dependencies
        script: |
          npm install
          npm ci
          cvm install 9.0.0
          cvm use 9.0.0                  
      - name: Add Android platform
        script: |
          set -x
          cordova platform remove android --nosave
          cordova platform add android --confirm --no-interactive --noresources          
      - name: Build Android
        script: |
          set -x
          set -e
          cordova build android --release --no-interactive --prod --device
          echo $KEYSTORE | base64 --decode > $KEYSTORE_PATH
          UNSIGNED_APK_PATH=$(find platforms/android/app/build/outputs -name "*.apk" | head -1)
          jarsigner -sigalg SHA1withRSA -digestalg SHA1 -keystore "${KEYSTORE_PATH}" -storepass "${KEYSTORE_PASSWORD}" -keypass "${KEY_ALIAS_PASSWORD}" "${UNSIGNED_APK_PATH}" "${KEY_ALIAS}"
          mv $UNSIGNED_APK_PATH $(echo $UNSIGNED_APK_PATH | sed 's/-unsigned//')          
    artifacts:
      - platforms/android/app/build/outputs/**/*.apk
      - platforms/android/app/build/outputs/**/mapping.txt
    publishing:
      # See the following link for details about email publishing - https://docs.codemagic.io/publishing-yaml/distribution/#email
      email:
        recipients:
          - nihal@nevercode.io